<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="SmartFileOrganizer.App.Pages.Controls.CurrentTreeView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <ScrollView>
        <VerticalStackLayout Padding="6">
            <CollectionView ItemsSource="{Binding CurrentRoot}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <!-- One node -->
                        <Grid Padding="6" ColumnDefinitions="*,Auto">
                            <!-- Expander for folders -->
                            <toolkit:Expander IsExpanded="False"
                                              IsVisible="{Binding IsFolder}">
                                <toolkit:Expander.Header>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Text="{Binding Name}" />
                                        <Label Grid.Column="1"
                                               Text="{Binding FileCount, StringFormat='({0} files)'}"
                                               IsVisible="{Binding IsFolder}" />
                                    </Grid>
                                </toolkit:Expander.Header>

                                <!-- Child nodes (recursive layout) -->
                                <CollectionView ItemsSource="{Binding Children}"
                                                SelectionMode="None"
                                                Margin="20,0,0,0">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <ContentView>
                                                <ContentView.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnTapped" />
                                                    <DragGestureRecognizer CanDrag="True" DragStarting="OnDragStarting" />
                                                    <DropGestureRecognizer AllowDrop="True" Drop="OnDrop" />
                                                </ContentView.GestureRecognizers>

                                                <Grid ColumnDefinitions="*,Auto" Padding="4">
                                                    <Label Text="{Binding Name}" />
                                                    <Label Grid.Column="1"
                                                           Text="{Binding FileCount, StringFormat='({0} files)'}"
                                                           IsVisible="{Binding IsFolder}" />
                                                </Grid>
                                            </ContentView>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </toolkit:Expander>

                            <!-- Files (no expander) -->
                            <ContentView IsVisible="{Binding IsFolder, Converter={StaticResource InverseBoolConverter}}">
                                <ContentView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnTapped" />
                                    <DragGestureRecognizer CanDrag="True" DragStarting="OnDragStarting" />
                                    <DropGestureRecognizer AllowDrop="True" Drop="OnDrop" />
                                </ContentView.GestureRecognizers>

                                <Label Text="{Binding Name}" />
                            </ContentView>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentView>